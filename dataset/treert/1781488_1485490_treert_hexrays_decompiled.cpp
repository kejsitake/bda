/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2014 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

int init_proc();
// int __cxa_atexit(const char *, ...); weak
// int __gmon_start__(void); weak
// _DWORD std::ios_base::Init::Init(std::ios_base::Init *this); idb
// _DWORD __cdecl std::ios_base::Init::~Init(std::ios_base::Init *__hidden this); idb
// int scanf(const char *format, ...);
// FILE *freopen(const char *filename, const char *modes, FILE *stream);
// int printf(const char *format, ...);
int deregister_tm_clones();
int register_tm_clones();
void _do_global_dtors_aux();
int frame_dummy();
int init(void);
int __cdecl gaoA(int a1, int a2, int a3);
int __cdecl gaoB(int a1, int a2, int a3);
int __cdecl dpf(int a1, int a2);
int __cdecl main(int argc, const char **argv, const char **envp);
int __cdecl __static_initialization_and_destruction_0(int a1, int a2);
int GLOBAL__sub_I_a();
int __cdecl std::max<long long>(int a1, int a2);
int __cdecl std::min<long long>(int a1, int a2);
void _libc_csu_fini(); // idb
void __cdecl _libc_csu_init();
void _i686_get_pc_thunk_bx();
int __fastcall _do_global_ctors_aux(int a1, int a2);
void term_proc();

//-------------------------------------------------------------------------
// Data declarations

int (*off_804A42C)() = &GLOBAL__sub_I_a; // weak
int _DTOR_LIST__[] = { 4294967295 }; // weak
_UNKNOWN _DTOR_END__; // weak
_UNKNOWN _dso_handle; // weak
FILE *edata; // idb
FILE *stdout; // idb
char completed_3328; // weak
int dtor_idx_3330; // weak
int a[]; // weak
int dword_804A5A4[]; // weak
int b[]; // weak
int dword_804A924[]; // weak
int at; // idb
int bt[]; // weak
int aa[]; // weak
int dword_804B024[]; // weak
int bb[]; // weak
int dword_8062A44[]; // weak
int n; // weak
int m; // weak
int dp[]; // weak
int dword_807A484[]; // weak
_UNKNOWN std::__ioinit; // weak
// extern _UNKNOWN _gmon_start__; weak


//----- (08048540) --------------------------------------------------------
int init_proc()
{
  int v0; // edx@3
  int v1; // ecx@3
  int v3; // [sp+0h] [bp-8h]@0

  if ( &_gmon_start__ )
    __gmon_start__();
  frame_dummy();
  _do_global_ctors_aux(v1, v0);
  return v3;
}
// 8048590: using guessed type int __gmon_start__(void);

//----- (08048620) --------------------------------------------------------
#error "8048623: positive sp value has been found (funcsize=2)"

//----- (08048650) --------------------------------------------------------
int deregister_tm_clones()
{
  int result; // eax@1

  result = 134522211 - (_DWORD)&edata;
  if ( (unsigned int)(134522211 - (_DWORD)&edata) > 6 )
    result = 0;
  return result;
}
// 8048650: could not find valid save-restore pair for ebp

//----- (08048680) --------------------------------------------------------
int register_tm_clones()
{
  return 0;
}
// 8048680: could not find valid save-restore pair for ebp

//----- (080486C0) --------------------------------------------------------
void _do_global_dtors_aux()
{
  int v0; // eax@2
  int i; // ebx@2

  if ( !completed_3328 )
  {
    v0 = dtor_idx_3330;
    for ( i = ((&_DTOR_END__ - (_UNKNOWN *)_DTOR_LIST__) >> 2) - 1; dtor_idx_3330 < (unsigned int)i; v0 = dtor_idx_3330 )
    {
      dtor_idx_3330 = v0 + 1;
      ((void (*)(void))_DTOR_LIST__[v0 + 1])();
    }
    deregister_tm_clones();
    completed_3328 = 1;
  }
}
// 804A434: using guessed type int _DTOR_LIST__[];
// 804A584: using guessed type char completed_3328;
// 804A588: using guessed type int dtor_idx_3330;

//----- (08048710) --------------------------------------------------------
int frame_dummy()
{
  return register_tm_clones();
}
// 8048710: could not find valid save-restore pair for ebp

//----- (08048740) --------------------------------------------------------
int init(void)
{
  int v0; // eax@3
  int v1; // eax@9
  int v2; // ecx@14
  int v3; // eax@14
  int v4; // ecx@17
  int v5; // eax@17
  int v6; // eax@21
  __int64 v7; // rcx@21
  int v8; // eax@21
  __int64 v9; // rax@21
  __int64 v10; // kr00_8@21
  int v11; // eax@27
  __int64 v12; // rcx@27
  int v13; // eax@27
  __int64 v14; // rax@27
  __int64 v15; // kr08_8@27
  int v16; // eax@33
  int v17; // eax@38
  int v18; // eax@41
  int result; // eax@42
  int j; // [sp+18h] [bp-10h]@2
  int l; // [sp+18h] [bp-10h]@8
  signed int jj; // [sp+18h] [bp-10h]@20
  signed int ll; // [sp+18h] [bp-10h]@26
  int nn; // [sp+18h] [bp-10h]@32
  signed int i; // [sp+1Ch] [bp-Ch]@1
  signed int k; // [sp+1Ch] [bp-Ch]@7
  int m; // [sp+1Ch] [bp-Ch]@13
  int n; // [sp+1Ch] [bp-Ch]@16
  signed int ii; // [sp+1Ch] [bp-Ch]@19
  signed int kk; // [sp+1Ch] [bp-Ch]@25
  int mm; // [sp+1Ch] [bp-Ch]@31
  int i1; // [sp+1Ch] [bp-Ch]@37
  int i2; // [sp+1Ch] [bp-Ch]@40

  scanf("%d%d", &::n, &::m);
  for ( i = 1; i <= 100; ++i )
  {
    for ( j = 0; j < ::n; ++j )
    {
      v0 = j + 110 * i;
      aa[2 * v0] = 0;
      dword_804B024[2 * v0] = 0;
    }
  }
  for ( k = 1; k <= 100; ++k )
  {
    for ( l = 0; l < ::m; ++l )
    {
      v1 = l + 110 * k;
      bb[2 * v1] = 0;
      dword_8062A44[2 * v1] = 0;
    }
  }
  for ( m = 0; m < ::n; ++m )
  {
    scanf("%I64d%d", 8 * m + 134522272, &at + m);
    v2 = dword_804A5A4[2 * m];
    v3 = m + 110 * *(&at + m);
    aa[2 * v3] = a[2 * m];
    dword_804B024[2 * v3] = v2;
  }
  for ( n = 0; n < ::m; ++n )
  {
    scanf("%I64d%d", 8 * n + 134523168, &bt[n]);
    v4 = dword_804A924[2 * n];
    v5 = n + 110 * bt[n];
    bb[2 * v5] = b[2 * n];
    dword_8062A44[2 * v5] = v4;
  }
  for ( ii = 1; ii <= 100; ++ii )
  {
    for ( jj = 1; jj < ::n; ++jj )
    {
      v6 = jj + 110 * ii;
      LODWORD(v7) = aa[2 * v6];
      HIDWORD(v7) = dword_804B024[2 * v6];
      v8 = jj - 1 + 110 * ii;
      HIDWORD(v9) = dword_804B024[2 * v8];
      LODWORD(v9) = aa[2 * v8];
      v10 = v9 + v7;
      LODWORD(v9) = jj + 110 * ii;
      aa[2 * (signed int)v9] = v10;
      dword_804B024[2 * (signed int)v9] = HIDWORD(v10);
    }
  }
  for ( kk = 1; kk <= 100; ++kk )
  {
    for ( ll = 1; ll < ::m; ++ll )
    {
      v11 = ll + 110 * kk;
      LODWORD(v12) = bb[2 * v11];
      HIDWORD(v12) = dword_8062A44[2 * v11];
      v13 = ll - 1 + 110 * kk;
      HIDWORD(v14) = dword_8062A44[2 * v13];
      LODWORD(v14) = bb[2 * v13];
      v15 = v14 + v12;
      LODWORD(v14) = ll + 110 * kk;
      bb[2 * (signed int)v14] = v15;
      dword_8062A44[2 * (signed int)v14] = HIDWORD(v15);
    }
  }
  for ( mm = 0; mm <= ::n; ++mm )
  {
    for ( nn = 0; nn <= ::m; ++nn )
    {
      v16 = nn + 110 * mm;
      dp[2 * v16] = -1;
      dword_807A484[2 * v16] = -1;
    }
  }
  for ( i1 = 0; i1 <= ::n; ++i1 )
  {
    v17 = ::m + 110 * i1;
    dp[2 * v17] = 0;
    dword_807A484[2 * v17] = 0;
  }
  for ( i2 = 0; ; ++i2 )
  {
    result = ::m;
    if ( i2 > ::m )
      break;
    v18 = i2 + 110 * ::n;
    dp[2 * v18] = 0;
    dword_807A484[2 * v18] = 0;
  }
  return result;
}
// 804A5A0: using guessed type int a[];
// 804A5A4: using guessed type int dword_804A5A4[];
// 804A920: using guessed type int b[];
// 804A924: using guessed type int dword_804A924[];
// 804AE60: using guessed type int bt[];
// 804B020: using guessed type int aa[];
// 804B024: using guessed type int dword_804B024[];
// 8062A40: using guessed type int bb[];
// 8062A44: using guessed type int dword_8062A44[];
// 807A460: using guessed type int n;
// 807A464: using guessed type int m;
// 807A480: using guessed type int dp[];
// 807A484: using guessed type int dword_807A484[];

//----- (08048BB1) --------------------------------------------------------
int __cdecl gaoA(int a1, int a2, int a3)
{
  int v3; // eax@2
  int v4; // edx@2
  int result; // eax@2

  if ( a1 )
  {
    result = aa[2 * (a2 - 1 + 110 * a3)] - aa[2 * (a1 - 1 + 110 * a3)];
  }
  else
  {
    v3 = a2 - 1 + 110 * a3;
    v4 = dword_804B024[2 * v3];
    result = aa[2 * v3];
  }
  return result;
}
// 804B020: using guessed type int aa[];
// 804B024: using guessed type int dword_804B024[];

//----- (08048C57) --------------------------------------------------------
int __cdecl gaoB(int a1, int a2, int a3)
{
  int v3; // eax@2
  int v4; // edx@2
  int result; // eax@2

  if ( a1 )
  {
    result = bb[2 * (a2 - 1 + 110 * a3)] - bb[2 * (a1 - 1 + 110 * a3)];
  }
  else
  {
    v3 = a2 - 1 + 110 * a3;
    v4 = dword_8062A44[2 * v3];
    result = bb[2 * v3];
  }
  return result;
}
// 8062A40: using guessed type int bb[];
// 8062A44: using guessed type int dword_8062A44[];

//----- (08048CFD) --------------------------------------------------------
int __cdecl dpf(int a1, int a2)
{
  int v2; // eax@2
  int v3; // edx@2
  int result; // eax@2
  int v5; // edx@3
  int v6; // edx@3
  int v7; // eax@3
  int v8; // edx@3
  int v9; // ecx@3
  int v10; // eax@3
  unsigned int v11; // ebx@6
  unsigned int v12; // edx@6
  unsigned int v13; // esi@6
  int v14; // edx@6
  int v15; // edx@6
  int v16; // eax@6
  int v17; // edx@6
  int v18; // ecx@6
  int v19; // eax@6
  int v20; // eax@10
  int v21; // edx@10
  int v22; // [sp+10h] [bp-38h]@3
  int v23; // [sp+14h] [bp-34h]@3
  int v24; // [sp+18h] [bp-30h]@3
  int v25; // [sp+1Ch] [bp-2Ch]@3
  unsigned __int64 v26; // [sp+20h] [bp-28h]@6
  int v27; // [sp+28h] [bp-20h]@6
  int v28; // [sp+2Ch] [bp-1Ch]@6
  int v29; // [sp+30h] [bp-18h]@6
  int v30; // [sp+34h] [bp-14h]@6
  int j; // [sp+38h] [bp-10h]@5
  int i; // [sp+3Ch] [bp-Ch]@4

  if ( ~dword_807A484[2 * (a2 + 110 * a1)] | ~dp[2 * (a2 + 110 * a1)] )
  {
    v2 = a2 + 110 * a1;
    v3 = dword_807A484[2 * v2];
    result = dp[2 * v2];
  }
  else
  {
    v22 = dpf(a1, a2 + 1);
    v23 = v5;
    v24 = dpf(a1 + 1, a2);
    v25 = v6;
    v7 = std::max<long long>((int)&v24, (int)&v22);
    v8 = *(_DWORD *)v7;
    v9 = *(_DWORD *)(v7 + 4);
    v10 = a2 + 110 * a1;
    dp[2 * v10] = v8;
    dword_807A484[2 * v10] = v9;
    if ( *(&at + a1) == bt[a2] )
    {
      for ( i = a1 + 1; i <= n; ++i )
      {
        for ( j = a2 + 1; j <= m; ++j )
        {
          v11 = dpf(i, j);
          v13 = v12;
          v27 = gaoB(a2, j, *(&at + a1));
          v28 = v14;
          v29 = gaoA(a1, i, *(&at + a1));
          v30 = v15;
          v26 = __PAIR__(v13, v11) + *(_QWORD *)std::min<long long>((int)&v29, (int)&v27);
          v16 = std::max<long long>((int)&dp[2 * (a2 + 110 * a1)], (int)&v26);
          v17 = *(_DWORD *)v16;
          v18 = *(_DWORD *)(v16 + 4);
          v19 = a2 + 110 * a1;
          dp[2 * v19] = v17;
          dword_807A484[2 * v19] = v18;
        }
      }
    }
    v20 = a2 + 110 * a1;
    v21 = dword_807A484[2 * v20];
    result = dp[2 * v20];
  }
  return result;
}
// 804AE60: using guessed type int bt[];
// 807A460: using guessed type int n;
// 807A464: using guessed type int m;
// 807A480: using guessed type int dp[];
// 807A484: using guessed type int dword_807A484[];

//----- (08048F64) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v3; // eax@3
  int v5; // [sp+18h] [bp-8h]@1
  int v6; // [sp+1Ch] [bp-4h]@1

  freopen("C-small-attempt0.in", "r", edata);
  freopen("C.out", "w", stdout);
  scanf("%d", &v5);
  v6 = 0;
  while ( 1 )
  {
    v3 = v5--;
    if ( v3 == 0 )
      break;
    ++v6;
    printf("Case #%d: ", v6);
    init();
    dpf(0, 0);
    printf("%I64d\n", dp[0], dword_807A484[0]);
  }
  return 0;
}
// 807A480: using guessed type int dp[];
// 807A484: using guessed type int dword_807A484[];

//----- (0804903A) --------------------------------------------------------
int __cdecl __static_initialization_and_destruction_0(int a1, int a2)
{
  int result; // eax@3

  if ( a1 == 1 && a2 == 0xFFFF )
  {
    std::ios_base::Init::Init((std::ios_base::Init *)&std::__ioinit);
    result = __cxa_atexit((const char *)std::ios_base::Init::~Init, &std::__ioinit, &_dso_handle);
  }
  return result;
}
// 8048580: using guessed type int __cxa_atexit(const char *, ...);

//----- (08049079) --------------------------------------------------------
int GLOBAL__sub_I_a()
{
  return __static_initialization_and_destruction_0(1, 0xFFFF);
}

//----- (08049095) --------------------------------------------------------
int __cdecl std::max<long long>(int a1, int a2)
{
  __int64 v2; // rcx@1
  __int64 v3; // rax@1
  int result; // eax@2

  LODWORD(v3) = *(_DWORD *)a2;
  HIDWORD(v2) = *(_DWORD *)(a1 + 4);
  HIDWORD(v3) = *(_DWORD *)(a2 + 4);
  LODWORD(v2) = *(_DWORD *)a1;
  if ( v2 >= v3 )
    result = a1;
  else
    result = a2;
  return result;
}

//----- (080490C0) --------------------------------------------------------
int __cdecl std::min<long long>(int a1, int a2)
{
  __int64 v2; // rcx@1
  __int64 v3; // rax@1
  int result; // eax@2

  LODWORD(v3) = *(_DWORD *)a1;
  HIDWORD(v2) = *(_DWORD *)(a2 + 4);
  HIDWORD(v3) = *(_DWORD *)(a1 + 4);
  LODWORD(v2) = *(_DWORD *)a2;
  if ( v2 >= v3 )
    result = a1;
  else
    result = a2;
  return result;
}

//----- (080490F0) --------------------------------------------------------
void _libc_csu_fini()
{
  ;
}

//----- (08049100) --------------------------------------------------------
void __cdecl _libc_csu_init()
{
  init_proc();
}

//----- (0804915A) --------------------------------------------------------
void _i686_get_pc_thunk_bx()
{
  ;
}

//----- (08049160) --------------------------------------------------------
int __fastcall _do_global_ctors_aux(int a1, int a2)
{
  int (**v2)(); // ebx@1
  void (__cdecl *v3)(); // eax@1
  int v5; // [sp-4h] [bp-8h]@1

  v5 = a2;
  v2 = &off_804A42C;
  v3 = (void (__cdecl *)())off_804A42C;
  if ( off_804A42C != (int (*)())-1 )
  {
    do
    {
      --v2;
      v3();
      v3 = (void (__cdecl *)())*v2;
    }
    while ( *v2 != (int (*)())-1 );
  }
  return v5;
}
// 804A42C: using guessed type int (*off_804A42C)();

//----- (08049188) --------------------------------------------------------
void term_proc()
{
  _do_global_dtors_aux();
}

#error "There were 1 decompilation failure(s) on 20 function(s)"
